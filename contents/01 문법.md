# 01. 문법

## 1.1 코드뭉치

하나의 파일이나 대화모드의 코드 한 줄처럼 루아에서 실행되는 코드 조각들을 코드뭉치(chunk)라고 한다.

## 1.2 어휘 규정

### 식별자

다른 언어들과 마찬가지로 루아의 식별자는 숫자로 시작하지 않는 영문자, 숫자, 밑줄로 조합할 수 있다.
예시는 다음과 같다.

- i
- i10
- _ij
- officeWorkerName
- _INPUT (단, 이런 식별자 이름은 피해야 한다)

### 예약어

```
and     break   do      else        elseif
end     false   for     function    if
in      local   nil     not         or
repeat  return  then    true        until
while
```

또한 대소문자를 구분하여, 예약어 `and`와 `And`, `AND`는 각각 다른 식별자로 간주한다.

### 주석

- 한 줄 주석: 하이픈 두 개(`--`)로 시작한다.
- 블록 주석: `--[[`으로 시작하여 `--]]`으로 끝난다.

## 1.3 전역 변수

전역 변수는 별도 선언이 필요 없고, 변수에 적당한 값을 배정하면 된다. 초기화되지 않은 변수에 접근할 수 있고, 이 경우에 `nil`을 반환하게 된다.

```Lua
print(a) --> nil
a = 10
print(a) --> 10
```

변수의 생명주기를 줄이고 싶다면 지역 변수를 사용해야 한다. 전역 변수를 굳이 지우는 경우에 `nil`을 배정한다.

```lua
a = nil
print(a) --> nil
```

위와 같이 실행된 직후에 루아는 마치 변수가 이전에 사용되지 않은 것처럼 작동한다. `nil`을 제외한 모든 경우에 전역 변수라고 볼 수 있다.

## 1.4 독립형 인터프리터

독립형 인터프리터는 루아를 직접 사용하게 해주는 프로그램이다. 루아의 인터프리터가 `/user/lua`에 위치한다고 가정했을때, 이렇게 스크립트를 시작할 수 있다.

~~~bash
#!/user/lua
~~~

또는 인터프리터를 거치지 않고 스크립트를 직접 실행하는 방법은 다음과 같다.

~~~bash
#!/user/env lua
~~~

### 루아 기본 사용 방법
~~~Lua
lua [options] [script [args]]
~~~

lua.exe를 매개변수 없이 실행하면 인터프리터는 대화모드로 실행된다.

~~~Lua
% lua -e "print(math.sin(10))"
~~~

~~~Lua
% lua -i -l a -e "i = 10"
~~~

- -e 옵션은 다음과 같이 명령행에 직접 코드를 넣을 수 있게 한다.
- -l 옵션은 라이브러리를 읽어 들인다.
- -i 옵션은 다른 인수를 모두 실행한 후, 대화모드가 된다.

위 예제는 라이브러리를 읽어 들이고, `i = 10` 명령을 실행하고 대화 프롬프트를 보여준다.

전역 변수 `_PROMPT`가 정의되어 있다면, `lua.exe`는 대화모드일 때 이 변수 값을 프롬프트로 사용한다.
~~~Lua
--[[ 루아 실행 후 PROMPT=' lua> '가 실행된다고 생각하면 된다.
     바깥쪽 큰따옴표는 안쪽 작은 따옴표가 셸이 아닌 루아에서 번역되도록 한다. ]]
% lua -i -e "_PROMPT=' lua> '" 
lua>
~~~
또한 배정 문자(=)로 문장을 시작하면 특정 구문의 결과값을 출력한다.
~~~Lua
> = math.sin(3) --> 0.14112000805987
> x = 30
> = x           --> 30
~~~

이 기능은 루아를 계산기처럼 쓸 수 있도록 해준다.

- `lua.exe`는 자신의 옵션 인수 실행 전, `LUA_INIT`이라는 이름의 환경 변수를 먼저 찾는다. 
    - 만약 그 변수가 존재하고 내용이 `@[filename]`이라면 해당 파일을 실행한다.
    - `@`문자로 시작하지 않는다면, 루아 코드가 담겨 있다고 보고 이것을 실행한다. 

`LUA_INIT`은 독립형 인터프리터의 설정을 변경하는 데 사용된다. 이는 다음과 같은 설정을 할 수 있다.
- 미리 패키지를 읽어 오기
- 프롬프트와 경로 변경
- 별도 함수 선언
- 함수 이름의 변경과 삭제 등

전역 변수 `arg`를 사용하면 인터프리터에 지정된 인수들을 스크립트에서 접근할 수 있다.
```Lua
% lua -e script a b
```
- 스크립트 시작 전 `arg` 테이블을 생성하고 모든 명령행 인수를 테이블에 넣는다.
- `script`를 기준으로 0번 좌 우로 -1, 1번 인수 형식으로 색인된다.
- 보통 스크립트는 양수 색인 값만 사용한다.
- 위 코드 블럭은 다음과 같이 인수를 모은다.
~~~lua
arg[-2] = "lua"
arg[-1] = "-e"
arg[0] = "script"
arg[1] = "a"
arg[2] = "b"
~~~

루아 5.1에서는 vararg 문법을 통하여 인수 얻기 기능도 지원한다. 스크립트의 body에서 `'···'`구문은 스크립트의 인수 내용을 반환한다.

---
출처
[프로그래밍 루아](https://search.shopping.naver.com/book/catalog/32492196601?query=%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D%20%EB%A3%A8%EC%95%84&NaPm=ct%3Dlg0lm4tc%7Cci%3D4ff95860ae3926b4ecded18df1cd90c3f669c3f1%7Ctr%3Dboksl%7Csn%3D95694%7Chk%3D03a50a86d09e9d6f540477098e76363425b34610)